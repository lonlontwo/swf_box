<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾Œå°ç®¡ç† - SWF å±•ç¤ºåº«</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #1a1a1a;
            --bg-card: #2d2d2d;
            --bg-input: #3a3a3a;
            --accent: #ff9800;
            --accent-hover: #ffa726;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --border: #444444;
            --success: #4caf50;
            --danger: #f44336;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--success);
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-danger {
            background: #555555;
            color: white;
            border: none;
        }

        .btn-danger:hover {
            background: #666666;
            transform: translateY(-1px);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 6px;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab {
            padding: 10px 20px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Add Form */
        .add-form {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .form-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .form-row {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            background: var(--accent-hover);
        }

        .submit-btn:disabled {
            background: var(--border);
            cursor: not-allowed;
        }

        /* Item List */
        .item-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .item-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
            cursor: default;
            user-select: none;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-height: 180px;
        }

        .item-card:hover {
            background: var(--bg-input);
            border-color: var(--border);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .item-card.dragging {
            opacity: 0.5;
            background: var(--accent);
        }

        .item-card.drag-over {
            border: 2px dashed var(--accent);
        }

        .drag-handle {
            display: none;
        }

        .item-header {
            display: flex;
            align-items: center;
            gap: 16px;
            width: 100%;
        }

        .item-icon {
            width: 64px;
            height: 64px;
            background: transparent;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
            overflow: hidden;
        }

        .item-info {
            flex: 1;
            min-width: 0;
        }

        .item-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .item-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .item-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid var(--success);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--success);
            font-weight: 500;
        }

        .item-url {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .item-url svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .item-url a {
            color: var(--text-secondary);
            text-decoration: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-url a:hover {
            color: var(--accent);
        }

        .item-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            margin-top: auto;
        }

        .item-footer-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-footer-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            border-radius: 26px;
            transition: 0.3s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle input:checked+.toggle-slider {
            background: var(--success);
        }

        .toggle input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }

        /* Login Screen (å…”å…”ç¶²é¢¨æ ¼é‡ç¾) */
        .login-screen {
            min-height: 100vh;
            background: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', -apple-system, sans-serif;
        }

        .login-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 40px 32px;
            width: 100%;
            max-width: 360px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a2a2a;
        }

        .login-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .login-title {
            color: #ffffff;
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            letter-spacing: 1px;
        }

        .login-title span {
            color: #f06e28;
            /* æ©™è‰² UI æ–‡å­— */
            margin-left: 4px;
        }

        .login-subtitle {
            color: #888;
            font-size: 13px;
            margin: 8px 0 32px 0;
            font-weight: 400;
        }

        .login-form {
            text-align: left;
        }

        .login-label {
            display: block;
            color: #aaa;
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .login-input {
            width: 100%;
            height: 44px;
            background: #252525;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 0 16px;
            color: #fff;
            font-size: 14px;
            margin-bottom: 16px;
            transition: all 0.2s;
            outline: none;
        }

        .login-input:focus {
            border-color: #f06e28;
            background: #2a2a2a;
        }

        .login-input::placeholder {
            color: #555;
        }

        .login-btn {
            width: 100%;
            height: 44px;
            background: #f06e28;
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .login-btn:hover {
            background: #ff7e3d;
            transform: translateY(-1px);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            color: #ff4d4d;
            font-size: 12px;
            text-align: center;
            margin-top: -8px;
            margin-bottom: 12px;
        }

        .login-back-link {
            display: inline-block;
            color: #666;
            text-decoration: none;
            font-size: 12px;
            margin-top: 16px;
            transition: color 0.2s;
        }

        .login-back-link:hover {
            color: #999;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        /* File Preview */
        .file-preview {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--accent);
            border-radius: 8px;
            margin-top: 8px;
        }

        .file-preview-name {
            flex: 1;
            font-weight: 500;
        }

        .file-preview-size {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .file-preview-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Progress Bar */
        .progress-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            margin: 20px;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* ================================ */
        /* RWD éŸ¿æ‡‰å¼è¨­è¨ˆ */
        /* ================================ */

        @media (max-width: 768px) {

            /* Header */
            .header {
                padding: 12px 16px;
                flex-wrap: wrap;
            }

            .logo {
                font-size: 1rem;
            }

            .header-actions {
                gap: 8px;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }

            .btn-small {
                padding: 4px 8px;
                font-size: 0.75rem;
            }

            /* Container */
            .container {
                padding: 16px;
            }

            /* Tabs */
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 8px 16px;
                font-size: 0.85rem;
                white-space: nowrap;
            }

            /* Form */
            .add-form {
                padding: 16px;
            }

            .form-title {
                font-size: 0.9rem;
            }

            .form-label {
                font-size: 0.8rem;
            }

            .form-input {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .submit-btn {
                padding: 12px;
                font-size: 0.95rem;
            }

            /* Item List */
            .item-list {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .item-card {
                padding: 16px;
                gap: 12px;
            }

            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .item-icon {
                width: 64px;
                height: 64px;
                background: white;
                border-radius: 12px;
                font-size: 2rem;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }

            .item-name {
                font-size: 1rem;
            }

            .item-url {
                font-size: 0.8rem;
            }

            .item-footer {
                padding-top: 10px;
            }

            .item-actions {
                gap: 6px;
            }

            /* Modal */
            .modal {
                margin: 10px;
                max-width: calc(100% - 20px);
            }

            .modal-header {
                padding: 16px;
            }

            .modal-title {
                font-size: 1.1rem;
            }

            .modal-body {
                padding: 16px;
            }

            .modal-footer {
                padding: 12px 16px;
                flex-direction: column-reverse;
            }

            .modal-footer .btn {
                width: 100%;
            }

            /* Login */
            .login-box {
                padding: 32px 24px;
                margin: 20px;
            }

            .login-title {
                font-size: 1.3rem;
            }

            /* Toggle */
            .toggle {
                width: 44px;
                height: 24px;
            }

            .toggle-slider:before {
                height: 18px;
                width: 18px;
            }

            .toggle input:checked+.toggle-slider:before {
                transform: translateX(20px);
            }

            /* File Preview */
            .file-preview {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .file-preview-name {
                word-break: break-all;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }

            .logo span:last-child {
                display: none;
                /* è¶…å°è¢å¹•éš±è—æ–‡å­— */
            }

            .container {
                padding: 12px;
            }

            .add-form {
                padding: 12px;
            }

            .item-card {
                padding: 10px;
            }

            .btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>

<body>
    <!-- Login Screen (å…”å…”ç¶²é¢¨æ ¼é‡ç¾) -->
    <div id="login-screen" class="login-screen">
        <div class="login-card">
            <div class="login-icon">ğŸ°</div>
            <h1 class="login-title">å…”å…”ç¶² <span>SWF</span></h1>
            <p class="login-subtitle">é¸å–æ¬Šé™ç®¡ç†ç³»çµ±</p>

            <div class="login-form">
                <label class="login-label">å¸³è™Ÿå¯†ç¢¼</label>
                <input type="password" id="password-input" class="login-input" placeholder="è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼" autofocus>
                <button id="login-btn" class="login-btn">ç™»å…¥</button>
                <p id="login-error" class="login-error" style="display: none;"></p>
            </div>

            <a href="index.html" class="login-back-link">+ è¿”å›é¦–é </a>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span>ğŸ¬</span>
                <span>SWF å¾Œå°ç®¡ç†</span>
            </div>
            <div class="header-actions">
                <a href="index.html" class="btn btn-secondary">ğŸ  å‰å°</a>
                <a href="https://github.com/jindrapetrik/jpexs-decompiler/releases" target="_blank"
                    class="btn btn-secondary">ğŸ”§ EXEâ†’SWF å·¥å…·</a>
                <button id="settings-btn" class="btn btn-secondary">âš™ï¸ è¨­å®š</button>
                <button id="logout-btn" class="btn btn-secondary">ğŸšª ç™»å‡º</button>
            </div>
        </header>

        <!-- Main -->
        <div class="container">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active">ğŸ“¤ æ–°å¢ä½œå“</div>
            </div>

            <!-- Add Form -->
            <div class="add-form">
                <div class="form-title">æ–°å¢ä½œå“</div>

                <div class="form-row">
                    <label class="form-label">ä½œå“æ¨™é¡Œ</label>
                    <input type="text" id="item-title" class="form-input" placeholder="è¼¸å…¥ä½œå“æ¨™é¡Œ...">
                </div>

                <div class="form-row">
                    <label class="form-label">ä¸Šå‚³æ–¹å¼</label>
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                            <input type="radio" name="upload-type" value="file" checked onchange="toggleUploadType()">
                            <span>å–®ä¸€æª”æ¡ˆ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                            <input type="radio" name="upload-type" value="folder" onchange="toggleUploadType()">
                            <span>è³‡æ–™å¤¾ï¼ˆå«å¤šå€‹æª”æ¡ˆï¼‰</span>
                        </label>
                    </div>
                </div>

                <div class="form-row" id="file-upload-section">
                    <label class="form-label">é¸æ“‡ SWF æª”æ¡ˆ</label>
                    <input type="file" id="file-input" class="form-input" accept=".swf">
                    <div id="file-preview" style="display: none;"></div>
                    <div id="progress-bar" class="progress-bar" style="display: none;">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                </div>

                <div class="form-row" id="folder-upload-section" style="display: none;">
                    <label class="form-label">é¸æ“‡è³‡æ–™å¤¾</label>
                    <input type="file" id="folder-input" class="form-input" webkitdirectory directory multiple>
                    <div id="folder-preview" style="display: none;"></div>
                    <div style="font-size: 0.85rem; color: #999; margin-top: 8px;">
                        ğŸ’¡ æç¤ºï¼šé¸æ“‡åŒ…å« SWF ä¸»æª”æ¡ˆå’Œç›¸é—œè³‡æºçš„è³‡æ–™å¤¾
                    </div>
                    <div id="folder-progress-bar" class="progress-bar" style="display: none;">
                        <div id="folder-progress-fill" class="progress-fill"></div>
                    </div>
                </div>

                <div style="text-align: center; color: #666; margin: 12px 0;">â”€â”€ æˆ– â”€â”€</div>

                <div class="form-row">
                    <label class="form-label">SWF é€£çµï¼ˆå·²æœ‰é€£çµæ™‚å¡«å¯«ï¼‰</label>
                    <input type="url" id="item-url" class="form-input"
                        placeholder="https://swf-api.lonlontwo0420.workers.dev/xxxx.swf">
                </div>

                <div class="form-row">
                    <label class="form-label">ç¸®åœ–é€£çµï¼ˆå¯é¸ï¼‰</label>
                    <input type="url" id="item-thumbnail" class="form-input"
                        placeholder="https://example.com/image.jpg">
                </div>

                <button id="submit-btn" class="submit-btn">ğŸ“¤ æ–°å¢ä½œå“</button>
            </div>

            <!-- Item List -->
            <div id="item-list" class="item-list"></div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">ğŸ“­</div>
                <h3>é‚„æ²’æœ‰ä»»ä½•ä½œå“</h3>
                <p>ä½¿ç”¨ä¸Šæ–¹è¡¨å–®æ–°å¢æ‚¨çš„ç¬¬ä¸€å€‹ SWF ä½œå“</p>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">âœï¸ ç·¨è¼¯ä½œå“</h3>
                <button class="modal-close" onclick="closeEditModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-id">
                <div class="form-row">
                    <label class="form-label">ä½œå“æ¨™é¡Œ</label>
                    <input type="text" id="edit-title" class="form-input" placeholder="è¼¸å…¥ä½œå“æ¨™é¡Œ...">
                </div>
                <div class="form-row">
                    <label class="form-label">SWF é€£çµ</label>
                    <input type="url" id="edit-url" class="form-input" placeholder="https://...">
                </div>
                <div class="form-row">
                    <label class="form-label">ç¸®åœ–é€£çµï¼ˆå¯é¸ï¼‰</label>
                    <input type="url" id="edit-thumbnail" class="form-input"
                        placeholder="https://example.com/image.jpg">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveEdit()">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">âš™ï¸ ç³»çµ±è¨­å®š</h3>
                <button class="modal-close" onclick="closeSettingsModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label class="form-label">ç›®å‰å¯†ç¢¼</label>
                    <input type="password" id="current-password" class="form-input" placeholder="è¼¸å…¥ç›®å‰å¯†ç¢¼...">
                </div>
                <div class="form-row">
                    <label class="form-label">æ–°å¯†ç¢¼</label>
                    <input type="password" id="new-password" class="form-input" placeholder="è¼¸å…¥æ–°å¯†ç¢¼...">
                </div>
                <div class="form-row">
                    <label class="form-label">ç¢ºèªæ–°å¯†ç¢¼</label>
                    <input type="password" id="confirm-password" class="form-input" placeholder="å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="savePassword()">ğŸ” æ›´æ–°å¯†ç¢¼</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script>
        let selectedFile = null;
        let selectedFolder = null;
        let uploadMode = 'file';
        let currentItems = []; // ä¿å­˜å·²è¼‰å…¥çš„é …ç›®
        const $ = id => document.getElementById(id);

        document.addEventListener('DOMContentLoaded', async () => {
            await initFirebase();
            if (sessionStorage.getItem('admin_logged_in') === 'true') {
                showAdmin();
            }
            $('login-btn').addEventListener('click', login);
            $('password-input').addEventListener('keypress', e => {
                if (e.key === 'Enter') login();
            });
            $('logout-btn').addEventListener('click', logout);
            $('settings-btn').addEventListener('click', openSettingsModal);
            $('submit-btn').addEventListener('click', submitForm);
            $('file-input').addEventListener('change', handleFileSelect);
            $('folder-input').addEventListener('change', handleFolderSelect);
        });

        async function login() {
            const password = $('password-input').value.trim();
            if (!password) {
                $('login-error').textContent = 'è«‹è¼¸å…¥å¯†ç¢¼';
                $('login-error').style.display = 'block';
                return;
            }
            const isValid = await DataAPI.verifyPassword(password);
            if (isValid) {
                sessionStorage.setItem('admin_logged_in', 'true');
                showAdmin();
            } else {
                $('login-error').textContent = 'å¯†ç¢¼éŒ¯èª¤';
                $('login-error').style.display = 'block';
            }
        }

        function logout() {
            sessionStorage.removeItem('admin_logged_in');
            $('admin-panel').style.display = 'none';
            $('login-screen').style.display = 'flex';
            $('password-input').value = '';
        }

        function toggleUploadType() {
            const mode = document.querySelector('input[name="upload-type"]:checked').value;
            uploadMode = mode;

            if (mode === 'file') {
                $('file-upload-section').style.display = 'block';
                $('folder-upload-section').style.display = 'none';
                selectedFolder = null;
            } else {
                $('file-upload-section').style.display = 'none';
                $('folder-upload-section').style.display = 'block';
                selectedFile = null;
            }
        }

        function showAdmin() {
            $('login-screen').style.display = 'none';
            $('admin-panel').style.display = 'block';
            loadItems();
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            selectedFile = file;
            if (!$('item-title').value) {
                $('item-title').value = file.name.replace('.swf', '');
            }
            $('file-preview').innerHTML = `
                <div class="file-preview">
                    <span>ğŸ¬</span>
                    <span class="file-preview-name">${file.name}</span>
                    <span class="file-preview-size">${formatSize(file.size)}</span>
                    <button class="file-preview-remove" onclick="removeFile()">âœ•</button>
                </div>
            `;
            $('file-preview').style.display = 'block';
        }

        function handleFolderSelect(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            selectedFolder = files;

            // æ‰¾åˆ° SWF ä¸»æª”æ¡ˆ
            const swfFile = files.find(f => f.name.endsWith('.swf'));
            if (swfFile && !$('item-title').value) {
                $('item-title').value = swfFile.name.replace('.swf', '');
            }

            // é¡¯ç¤ºæª”æ¡ˆåˆ—è¡¨
            const fileList = files.map(f => `
                <div style="font-size: 0.85rem; padding: 4px 0;">
                    ğŸ“„ ${f.webkitRelativePath || f.name} (${formatSize(f.size)})
                </div>
            `).join('');

            $('folder-preview').innerHTML = `
                <div style="background: rgba(255, 152, 0, 0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 12px; margin-top: 8px; max-height: 200px; overflow-y: auto;">
                    <div style="font-weight: 600; margin-bottom: 8px;">ğŸ“ å·²é¸æ“‡ ${files.length} å€‹æª”æ¡ˆï¼š</div>
                    ${fileList}
                </div>
            `;
            $('folder-preview').style.display = 'block';
        }

        function removeFile() {
            selectedFile = null;
            $('file-input').value = '';
            $('file-preview').style.display = 'none';
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        async function submitForm() {
            const title = $('item-title').value.trim();
            const thumbnail = $('item-thumbnail').value.trim();
            const manualUrl = $('item-url').value.trim();

            if (!title) { alert('è«‹è¼¸å…¥ä½œå“æ¨™é¡Œ'); return; }

            // å¦‚æœæœ‰æ‰‹å‹•è¼¸å…¥ URLï¼Œå°±ç›´æ¥ç”¨ URL
            if (manualUrl) {
                await DataAPI.addItem({ title, swfUrl: manualUrl, thumbnail, filename: '' });
                $('item-title').value = '';
                $('item-url').value = '';
                $('item-thumbnail').value = '';
                loadItems();
                alert('âœ… æ–°å¢æˆåŠŸï¼');
                return;
            }

            // è³‡æ–™å¤¾ä¸Šå‚³æ¨¡å¼
            if (uploadMode === 'folder' && selectedFolder) {
                await uploadFolder(title, thumbnail);
                return;
            }

            // å–®ä¸€æª”æ¡ˆä¸Šå‚³æ¨¡å¼
            if (!selectedFile) { alert('è«‹é¸æ“‡ SWF æª”æ¡ˆæˆ–è¼¸å…¥ SWF é€£çµ'); return; }

            $('submit-btn').disabled = true;
            $('submit-btn').textContent = 'ä¸Šå‚³ä¸­...';
            $('progress-bar').style.display = 'block';

            try {
                const filename = `${Date.now()}_${selectedFile.name}`;

                // ä½¿ç”¨å¯¦éš›é€²åº¦å›èª¿
                const swfUrl = await SWFAPI.uploadFile(selectedFile, filename, (progress) => {
                    $('progress-fill').style.width = progress + '%';
                    $('submit-btn').textContent = `ä¸Šå‚³ä¸­... ${progress}%`;
                });

                await DataAPI.addItem({ title, swfUrl, thumbnail, filename });

                $('item-title').value = '';
                $('item-url').value = '';
                $('item-thumbnail').value = '';
                removeFile();
                $('progress-bar').style.display = 'none';
                $('progress-fill').style.width = '0%';
                loadItems();
                alert('âœ… ä¸Šå‚³æˆåŠŸï¼');
            } catch (error) {
                console.error(error);
                alert('âŒ ä¸Šå‚³å¤±æ•—: ' + error.message);
            }

            $('submit-btn').disabled = false;
            $('submit-btn').textContent = 'ğŸ“¤ æ–°å¢ä½œå“';
        }

        // è³‡æ–™å¤¾ä¸Šå‚³å‡½æ•¸
        async function uploadFolder(title, thumbnail) {
            if (!selectedFolder || selectedFolder.length === 0) {
                alert('è«‹é¸æ“‡è³‡æ–™å¤¾');
                return;
            }

            $('submit-btn').disabled = true;
            $('submit-btn').textContent = 'ä¸Šå‚³è³‡æ–™å¤¾ä¸­...';
            $('folder-progress-bar').style.display = 'block';

            try {
                const folderName = `${Date.now()}_${title.replace(/[^a-zA-Z0-9]/g, '_')}`;
                let uploaded = 0;

                // æ‰¾åˆ° SWF ä¸»æª”æ¡ˆ
                const swfFile = selectedFolder.find(f => f.name.endsWith('.swf'));
                if (!swfFile) {
                    alert('âŒ è³‡æ–™å¤¾ä¸­æ²’æœ‰æ‰¾åˆ° SWF æª”æ¡ˆ');
                    return;
                }

                // ä¸Šå‚³æ‰€æœ‰æª”æ¡ˆ
                for (const file of selectedFolder) {
                    const relativePath = file.webkitRelativePath || file.name;
                    const filename = `${folderName}/${relativePath}`;

                    // ä½¿ç”¨é€²åº¦å›èª¿
                    await SWFAPI.uploadFile(file, filename, (fileProgress) => {
                        // è¨ˆç®—ç¸½é€²åº¦ï¼šå·²å®Œæˆæª”æ¡ˆ + ç•¶å‰æª”æ¡ˆé€²åº¦
                        const totalProgress = ((uploaded + fileProgress / 100) / selectedFolder.length) * 100;
                        $('folder-progress-fill').style.width = totalProgress + '%';
                        $('submit-btn').textContent = `ä¸Šå‚³ä¸­... ${Math.round(totalProgress)}%`;
                    });

                    uploaded++;
                    const progress = (uploaded / selectedFolder.length) * 100;
                    $('folder-progress-fill').style.width = progress + '%';
                }

                // ä¸»æª”æ¡ˆ URL
                const swfUrl = `${SWF_API_URL}/${folderName}/${swfFile.webkitRelativePath || swfFile.name}`;

                await DataAPI.addItem({ title, swfUrl, thumbnail, filename: folderName });

                $('item-title').value = '';
                $('item-url').value = '';
                $('item-thumbnail').value = '';
                selectedFolder = null;
                $('folder-input').value = '';
                $('folder-preview').style.display = 'none';
                $('folder-progress-bar').style.display = 'none';
                $('folder-progress-fill').style.width = '0%';

                loadItems();
                alert(`âœ… è³‡æ–™å¤¾ä¸Šå‚³æˆåŠŸï¼å…± ${uploaded} å€‹æª”æ¡ˆ`);
            } catch (error) {
                console.error(error);
                alert('âŒ è³‡æ–™å¤¾ä¸Šå‚³å¤±æ•—: ' + error.message);
            }

            $('submit-btn').disabled = false;
            $('submit-btn').textContent = 'ğŸ“¤ æ–°å¢ä½œå“';
        }

        async function loadItems() {
            const items = await DataAPI.getItems();

            // æŒ‰ç…§ order æ¬„ä½æ’åºï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰ï¼Œå¦å‰‡æŒ‰å»ºç«‹æ™‚é–“
            items.sort((a, b) => {
                if (a.order !== undefined && b.order !== undefined) {
                    return a.order - b.order;
                }
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            currentItems = items; // ä¿å­˜åˆ°å…¨åŸŸè®Šæ•¸

            if (items.length === 0) {
                $('item-list').innerHTML = '';
                $('empty-state').style.display = 'block';
                return;
            }

            $('empty-state').style.display = 'none';
            $('item-list').innerHTML = items.map((item, index) => `
                <div class="item-card" draggable="true" data-id="${item.id}" data-index="${index}">
                    <div class="item-header">
                        <div class="item-icon">
                            ${item.thumbnail
                    ? `<img src="${item.thumbnail}" alt="${escapeHtml(item.title)}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`
                    : 'ğŸ¬'
                }
                        </div>
                        <div class="item-info">
                            <div class="item-title">
                                <span class="item-name">${escapeHtml(item.title)}</span>
                                <span class="item-badge">å•Ÿç”¨</span>
                            </div>
                            <div class="item-url">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                                </svg>
                                <a href="${item.swfUrl}" target="_blank" onclick="event.stopPropagation()" title="${item.swfUrl}">${item.swfUrl.length > 40 ? item.swfUrl.substring(0, 40) + '...' : item.swfUrl}</a>
                            </div>
                        </div>
                    </div>
                    <div class="item-footer">
                        <div class="item-footer-left">
                            <button class="btn btn-small btn-primary" onclick="event.stopPropagation(); editItem('${item.id}')">ç·¨è¼¯</button>
                        </div>
                        <div class="item-footer-right">
                            <button class="btn btn-small btn-danger" onclick="event.stopPropagation(); deleteItem('${item.id}', '${item.filename || ''}')">ğŸ—‘ï¸</button>
                            <label class="toggle" onclick="event.stopPropagation()">
                                <input type="checkbox" ${item.visible !== false ? 'checked' : ''} onchange="toggleVisibility('${item.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            `).join('');

            setupDragAndDrop();
        }

        function playItem(url, title) {
            window.open(`player?url=${url}&title=${title}`, '_blank');
        }

        function editItem(id) {
            // å¾å·²è¼‰å…¥çš„é …ç›®ä¸­æ‰¾è³‡æ–™
            const item = currentItems.find(i => i.id === id);
            if (!item) {
                console.error('æ‰¾ä¸åˆ°é …ç›®:', id);
                alert('æ‰¾ä¸åˆ°è¦ç·¨è¼¯çš„é …ç›®');
                return;
            }

            $('edit-id').value = id;
            $('edit-title').value = item.title;
            $('edit-url').value = item.swfUrl;
            $('edit-thumbnail').value = item.thumbnail || '';

            $('edit-modal').classList.add('active');
        }

        function closeEditModal() {
            $('edit-modal').classList.remove('active');
        }

        function saveEdit() {
            const id = $('edit-id').value;
            const title = $('edit-title').value.trim();
            const swfUrl = $('edit-url').value.trim();
            const thumbnail = $('edit-thumbnail').value.trim();

            if (!title) {
                alert('è«‹è¼¸å…¥ä½œå“æ¨™é¡Œ');
                return;
            }
            if (!swfUrl) {
                alert('è«‹è¼¸å…¥ SWF é€£çµ');
                return;
            }

            DataAPI.updateItem(id, { title, swfUrl, thumbnail });
            closeEditModal();
            loadItems();
            alert('âœ… å·²å„²å­˜');
        }

        async function deleteItem(id, filename) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œå“å—ï¼Ÿ')) return;
            try {
                if (filename) await SWFAPI.deleteFile(filename);
                await DataAPI.deleteItem(id);
                loadItems();
                alert('âœ… å·²åˆªé™¤');
            } catch (error) {
                console.error(error);
                alert('âŒ åˆªé™¤å¤±æ•—');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // åˆ‡æ›å‰å°é¡¯ç¤º/éš±è—
        async function toggleVisibility(id, visible) {
            try {
                await DataAPI.updateItem(id, { visible });
                console.log(`âœ… é …ç›® ${id} å·²${visible ? 'é¡¯ç¤º' : 'éš±è—'}`);
            } catch (error) {
                console.error('æ›´æ–°é¡¯ç¤ºç‹€æ…‹å¤±æ•—:', error);
                alert('âŒ æ›´æ–°å¤±æ•—');
                // é‡æ–°è¼‰å…¥ä»¥æ¢å¾©åŸç‹€æ…‹
                loadItems();
            }
        }

        // æ‹–æ›³æ’åº
        let draggedItem = null;
        let draggedIndex = null;

        function setupDragAndDrop() {
            const cards = document.querySelectorAll('.item-card');
            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('dragenter', handleDragEnter);
                card.addEventListener('dragleave', handleDragLeave);
                card.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = this;
            draggedIndex = parseInt(this.dataset.index);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.item-card').forEach(card => {
                card.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            if (this !== draggedItem) this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        async function handleDrop(e) {
            e.preventDefault();
            if (this === draggedItem) return;

            const targetIndex = parseInt(this.dataset.index);

            // ä½¿ç”¨å·²è¼‰å…¥çš„ Firebase è³‡æ–™
            let items = [...currentItems];

            // é‡æ–°æ’åº
            const [movedItem] = items.splice(draggedIndex, 1);
            items.splice(targetIndex, 0, movedItem);

            // æ›´æ–°æ¯å€‹é …ç›®çš„ order æ¬„ä½åˆ° Firebase
            try {
                for (let i = 0; i < items.length; i++) {
                    await DataAPI.updateItem(items[i].id, { order: i });
                }

                // é‡æ–°è¼‰å…¥é …ç›®ä»¥é¡¯ç¤ºæ–°é †åº
                await loadItems();
            } catch (error) {
                console.error('æ’åºå„²å­˜å¤±æ•—:', error);
                alert('âŒ æ’åºå„²å­˜å¤±æ•—');
            }
        }

        // ================================
        // è¨­å®šåŠŸèƒ½
        // ================================

        function openSettingsModal() {
            $('current-password').value = '';
            $('new-password').value = '';
            $('confirm-password').value = '';
            $('settings-modal').classList.add('active');
        }

        function closeSettingsModal() {
            $('settings-modal').classList.remove('active');
        }

        async function savePassword() {
            const currentPwd = $('current-password').value.trim();
            const newPwd = $('new-password').value.trim();
            const confirmPwd = $('confirm-password').value.trim();

            if (!currentPwd || !newPwd || !confirmPwd) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
                return;
            }

            // é©—è­‰ç›®å‰å¯†ç¢¼
            const isValid = await DataAPI.verifyPassword(currentPwd);
            if (!isValid) {
                alert('âŒ ç›®å‰å¯†ç¢¼éŒ¯èª¤');
                return;
            }

            // ç¢ºèªæ–°å¯†ç¢¼
            if (newPwd !== confirmPwd) {
                alert('âŒ æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ç¬¦');
                return;
            }

            if (newPwd.length < 6) {
                alert('âŒ å¯†ç¢¼è‡³å°‘éœ€è¦ 6 å€‹å­—å…ƒ');
                return;
            }

            // å„²å­˜æ–°å¯†ç¢¼
            try {
                await DataAPI.updatePassword(newPwd);
                closeSettingsModal();
                alert('âœ… å¯†ç¢¼å·²æ›´æ–°ï¼ä¸‹æ¬¡ç™»å…¥è«‹ä½¿ç”¨æ–°å¯†ç¢¼');
            } catch (error) {
                console.error(error);
                alert('âŒ å¯†ç¢¼æ›´æ–°å¤±æ•—');
            }
        }
    </script>

    <!-- é˜²è­·æ©Ÿåˆ¶ -->
    <script>
        // ç¦æ­¢å³éµ
        document.addEventListener('contextmenu', e => e.preventDefault());

        // ç¦æ­¢ F12ã€Ctrl+Shift+Iã€Ctrl+Shift+Jã€Ctrl+U
        document.addEventListener('keydown', e => {
            if (e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                return false;
            }
        });

        // ç¦æ­¢é¸å–æ–‡å­—
        document.addEventListener('selectstart', e => e.preventDefault());
    </script>
</body>

</html>